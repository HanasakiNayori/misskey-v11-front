{"version":3,"sources":["webpack:///./src/client/app/common/views/components/messaging.vue?a8d6","webpack:///./src/client/app/common/views/components/messaging.vue?d5a6","webpack:///./src/client/app/common/views/components/messaging.vue?c17f","webpack:///./src/client/app/common/views/components/messaging.vue?3ccd","webpack:///./src/client/app/common/views/components/messaging.vue?a62a","webpack:///./src/client/app/common/views/components/messaging.vue","webpack:///./src/client/app/common/views/components/messaging.vue?17ef"],"names":["exports","___CSS_LOADER_API_IMPORT___","push","module","i","extend","i18n","props","compact","type","Boolean","default","headerTop","Number","data","fetching","moreFetching","messages","q","result","connection","faUser","faUsers","this","$root","stream","useSharedConnection","on","onMessage","onRead","api","group","then","userMessages","groupMessages","concat","sort","a","b","Date","createdAt","getTime","dispose","methods","getAcct","message","userId","$store","state","id","recipientId","filter","m","unshift","groupId","ids","found","find","isRead","reads","query","localOnly","limit","detail","users","user","$emit","e","which","preventDefault","stopPropagation","$refs","searchResult","childNodes","focus","list","cancel","search","shiftKey","previousElementSibling","length","nextElementSibling","dialog","local","navigate","groups1","groups2","canceled","title","$t","select","items","map","value","text","name","showCancelButton","navigateGroup","component","_vm","_h","$createElement","_c","_self","staticClass","attrs","_e","style","top","directives","rawName","expression","domProps","$event","target","composing","onSearchKeydown","ref","_l","indexOf","_k","keyCode","key","onSearchResultKeydown","_v","_s","_f","isMe","recipient","includes","startUser","startGroup","content","locals","add"],"mappings":"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","file":"21.11.37.1.js","sourcesContent":["import mod from \"-!../../../../../../node_modules/vue-style-loader/index.js!../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../node_modules/postcss-loader/src/index.js??ref--1-oneOf-1-2!../../../../../../node_modules/stylus-loader/index.js!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./messaging.vue?vue&type=style&index=0&id=79802e58&lang=stylus&scoped=true&\"; export default mod; export * from \"-!../../../../../../node_modules/vue-style-loader/index.js!../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../node_modules/postcss-loader/src/index.js??ref--1-oneOf-1-2!../../../../../../node_modules/stylus-loader/index.js!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./messaging.vue?vue&type=style&index=0&id=79802e58&lang=stylus&scoped=true&\"","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".mk-messaging[data-compact][data-v-79802e58]{font-size:.8em}.mk-messaging[data-compact]>.history>a[data-v-79802e58]:last-child{border-bottom:none}.mk-messaging[data-compact]>.history>a:not([data-is-me]):not([data-is-read])>div[data-v-79802e58]{background-image:none;border-left:4px solid #3aa2dc}.mk-messaging[data-compact]>.history>a>div[data-v-79802e58]{padding:16px}.mk-messaging[data-compact]>.history>a>div>header>.mk-time[data-v-79802e58]{font-size:1em}.mk-messaging[data-compact]>.history>a>div>.avatar[data-v-79802e58]{width:42px;height:42px;margin:0 12px 0 0}.mk-messaging>.search[data-v-79802e58]{display:block;position:-webkit-sticky;position:sticky;top:0;left:0;z-index:1;width:100%;box-shadow:0 0 2px rgba(0,0,0,.2)}.mk-messaging>.search>.form[data-v-79802e58]{background:rgba(0,0,0,.02)}.mk-messaging>.search>.form>label[data-v-79802e58]{display:block;position:absolute;top:0;left:8px;z-index:1;height:100%;width:38px;pointer-events:none}.mk-messaging>.search>.form>label>i[data-v-79802e58]{display:block;position:absolute;top:0;right:0;bottom:0;left:0;width:1em;line-height:48px;margin:auto;color:#555}.mk-messaging>.search>.form>input[data-v-79802e58]{margin:0;padding:0 0 0 42px;width:100%;font-size:1em;line-height:48px;color:var(--faceText);outline:none;background:transparent;border:none;border-radius:5px;box-shadow:none}.mk-messaging>.search>.result[data-v-79802e58]{display:block;top:0;left:0;z-index:2;width:100%;margin:0;padding:0;background:#fff}.mk-messaging>.search>.result>.users[data-v-79802e58]{margin:0;padding:0;list-style:none}.mk-messaging>.search>.result>.users>li[data-v-79802e58]{display:inline-block;z-index:1;width:100%;padding:8px 32px;vertical-align:top;white-space:nowrap;overflow:hidden;color:rgba(0,0,0,.8);text-decoration:none;transition:none;cursor:pointer}.mk-messaging>.search>.result>.users>li[data-v-79802e58]:focus,.mk-messaging>.search>.result>.users>li[data-v-79802e58]:hover{color:#fff;background:var(--primary)}.mk-messaging>.search>.result>.users>li:focus .name[data-v-79802e58],.mk-messaging>.search>.result>.users>li:focus .username[data-v-79802e58],.mk-messaging>.search>.result>.users>li:hover .name[data-v-79802e58],.mk-messaging>.search>.result>.users>li:hover .username[data-v-79802e58]{color:#fff}.mk-messaging>.search>.result>.users>li[data-v-79802e58]:active{color:#fff;background:var(--primaryDarken10)}.mk-messaging>.search>.result>.users>li:active .name[data-v-79802e58],.mk-messaging>.search>.result>.users>li:active .username[data-v-79802e58]{color:#fff}.mk-messaging>.search>.result>.users>li .avatar[data-v-79802e58]{vertical-align:middle;min-width:32px;min-height:32px;max-width:32px;max-height:32px;margin:0 8px 0 0;border-radius:6px}.mk-messaging>.search>.result>.users>li .name[data-v-79802e58]{margin:0 8px 0 0;font-weight:400;color:rgba(0,0,0,.8)}.mk-messaging>.search>.result>.users>li .username[data-v-79802e58]{font-weight:400;color:rgba(0,0,0,.3)}.mk-messaging>.history>a[data-v-79802e58]{display:block;text-decoration:none;background:var(--face);border-bottom:1px solid var(--faceDivider)}.mk-messaging>.history>a *[data-v-79802e58]{pointer-events:none;user-select:none}.mk-messaging>.history>a[data-v-79802e58]:hover{box-shadow:inset 0 0 0 100px rgba(0,0,0,.05)}.mk-messaging>.history>a:hover .avatar[data-v-79802e58]{filter:saturate(200%)}.mk-messaging>.history>a[data-v-79802e58]:active{box-shadow:inset 0 0 0 100px rgba(0,0,0,.1)}.mk-messaging>.history>a[data-is-me][data-v-79802e58],.mk-messaging>.history>a[data-is-read][data-v-79802e58]{opacity:.8}.mk-messaging>.history>a:not([data-is-me]):not([data-is-read])>div[data-v-79802e58]{background-image:url(/assets/unread.svg);background-repeat:no-repeat;background-position:0}.mk-messaging>.history>a[data-v-79802e58]:after{content:\\\"\\\";display:block;clear:both}.mk-messaging>.history>a>div[data-v-79802e58]{max-width:500px;margin:0 auto;padding:20px 30px}.mk-messaging>.history>a>div[data-v-79802e58]:after{content:\\\"\\\";display:block;clear:both}.mk-messaging>.history>a>div>header[data-v-79802e58]{display:flex;align-items:center;margin-bottom:2px;white-space:nowrap;overflow:hidden}.mk-messaging>.history>a>div>header>.name[data-v-79802e58]{margin:0;padding:0;overflow:hidden;text-overflow:ellipsis;font-size:1em;color:var(--noteHeaderName);font-weight:700;transition:all .1s ease}.mk-messaging>.history>a>div>header>.username[data-v-79802e58]{margin:0 8px;color:var(--noteHeaderAcct)}.mk-messaging>.history>a>div>header>.mk-time[data-v-79802e58]{margin:0 0 0 auto;color:var(--noteHeaderInfo);font-size:80%}.mk-messaging>.history>a>div>.avatar[data-v-79802e58]{float:left;width:54px;height:54px;margin:0 16px 0 0;border-radius:8px;transition:all .1s ease}.mk-messaging>.history>a>div>.body>.text[data-v-79802e58]{display:block;margin:0;padding:0;overflow:hidden;overflow-wrap:break-word;font-size:1.1em;color:var(--faceText)}.mk-messaging>.history>a>div>.body>.text .me[data-v-79802e58]{opacity:.7}.mk-messaging>.history>a>div>.body>.image[data-v-79802e58]{display:block;max-width:100%;max-height:512px}.mk-messaging>.no-history[data-v-79802e58]{margin:0;padding:2em 1em;text-align:center;color:#999;font-weight:500}.mk-messaging>.fetching[data-v-79802e58]{margin:0;padding:16px;text-align:center;color:var(--text)}.mk-messaging>.fetching>[data-icon][data-v-79802e58]{margin-right:4px}@media (max-width:400px){.mk-messaging>.search>.result>.users>li[data-v-79802e58]{padding:8px 16px}.mk-messaging>.history>a:not([data-is-me]):not([data-is-read])>div[data-v-79802e58]{background-image:none;border-left:4px solid #3aa2dc}.mk-messaging>.history>a>div[data-v-79802e58]{padding:16px;font-size:14px}.mk-messaging>.history>a>div>.avatar[data-v-79802e58]{margin:0 12px 0 0}}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"mk-messaging\",attrs:{\"data-compact\":_vm.compact}},[(!_vm.compact)?_c('div',{staticClass:\"search\",style:({ top: _vm.headerTop + 'px' })},[_c('div',{staticClass:\"form\"},[_c('label',{attrs:{\"for\":\"search-input\"}},[_c('i',[_c('fa',{attrs:{\"icon\":\"search\"}})],1)]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.q),expression:\"q\"}],attrs:{\"type\":\"search\",\"placeholder\":_vm.$t('search-user')},domProps:{\"value\":(_vm.q)},on:{\"input\":[function($event){if($event.target.composing){ return; }_vm.q=$event.target.value},_vm.search],\"keydown\":_vm.onSearchKeydown}})]),_c('div',{staticClass:\"result\"},[(_vm.result.length > 0)?_c('ol',{ref:\"searchResult\",staticClass:\"users\"},_vm._l((_vm.result),function(user,i){return _c('li',{attrs:{\"tabindex\":\"-1\"},on:{\"keydown\":[function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.navigate(user)},function($event){return _vm.onSearchResultKeydown(i)}],\"click\":function($event){return _vm.navigate(user)}}},[_c('mk-avatar',{key:user.id,staticClass:\"avatar\",attrs:{\"user\":user}}),_c('span',{staticClass:\"name\"},[_c('mk-user-name',{key:user.id,attrs:{\"user\":user}})],1),_c('span',{staticClass:\"username\"},[_vm._v(\"@\"+_vm._s(_vm._f(\"acct\")(user)))])],1)}),0):_vm._e()])]):_vm._e(),(_vm.messages.length > 0)?_c('div',{staticClass:\"history\"},_vm._l((_vm.messages),function(message){return _c('a',{key:message.id,staticClass:\"user\",attrs:{\"href\":message.groupId ? (\"/i/messaging/group/\" + (message.groupId)) : (\"/i/messaging/\" + (_vm.getAcct(_vm.isMe(message) ? message.recipient : message.user))),\"data-is-me\":_vm.isMe(message),\"data-is-read\":message.groupId ? message.reads.includes(_vm.$store.state.i.id) : message.isRead},on:{\"click\":function($event){$event.preventDefault();message.groupId ? _vm.navigateGroup(message.group) : _vm.navigate(_vm.isMe(message) ? message.recipient : message.user)}}},[_c('div',[_c('mk-avatar',{staticClass:\"avatar\",attrs:{\"user\":message.groupId ? message.user : _vm.isMe(message) ? message.recipient : message.user}}),(message.groupId)?_c('header',[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(message.group.name))]),_c('mk-time',{attrs:{\"time\":message.createdAt}})],1):_c('header',[_c('span',{staticClass:\"name\"},[_c('mk-user-name',{attrs:{\"user\":_vm.isMe(message) ? message.recipient : message.user}})],1),_c('span',{staticClass:\"username\"},[_vm._v(\"@\"+_vm._s(_vm._f(\"acct\")(_vm.isMe(message) ? message.recipient : message.user)))]),_c('mk-time',{attrs:{\"time\":message.createdAt}})],1),_c('div',{staticClass:\"body\"},[_c('p',{staticClass:\"text\"},[(_vm.isMe(message))?_c('span',{staticClass:\"me\"},[_vm._v(_vm._s(_vm.$t('you'))+\":\")]):_vm._e(),_vm._v(_vm._s(message.text))])])],1)])}),0):_vm._e(),(!_vm.fetching && _vm.messages.length == 0)?_c('p',{staticClass:\"no-history\"},[_vm._v(_vm._s(_vm.$t('no-history')))]):_vm._e(),(_vm.fetching)?_c('p',{staticClass:\"fetching\"},[_c('fa',{attrs:{\"icon\":\"spinner\",\"pulse\":\"\",\"fixed-width\":\"\"}}),_vm._v(_vm._s(_vm.$t('@.loading'))),_c('mk-ellipsis')],1):_vm._e(),_c('ui-margin',[_c('ui-button',{on:{\"click\":function($event){return _vm.startUser()}}},[_c('fa',{attrs:{\"icon\":_vm.faUser}}),_vm._v(\" \"+_vm._s(_vm.$t('start-with-user')))],1),_c('ui-button',{on:{\"click\":function($event){return _vm.startGroup()}}},[_c('fa',{attrs:{\"icon\":_vm.faUsers}}),_vm._v(\" \"+_vm._s(_vm.$t('start-with-group')))],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../../../../../node_modules/ts-loader/index.js??ref--5-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./messaging.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../../../node_modules/ts-loader/index.js??ref--5-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./messaging.vue?vue&type=script&lang=ts&\"","import Vue from 'vue';\nimport { faUser, faUsers } from '@fortawesome/free-solid-svg-icons';\nimport i18n from '../../../i18n';\nimport getAcct from '../../../../../misc/acct/render';\nexport default Vue.extend({\n    i18n: i18n('common/views/components/messaging.vue'),\n    props: {\n        compact: {\n            type: Boolean,\n            default: false\n        },\n        headerTop: {\n            type: Number,\n            default: 0\n        }\n    },\n    data() {\n        return {\n            fetching: true,\n            moreFetching: false,\n            messages: [],\n            q: null,\n            result: [],\n            connection: null,\n            faUser, faUsers\n        };\n    },\n    mounted() {\n        this.connection = this.$root.stream.useSharedConnection('messagingIndex');\n        this.connection.on('message', this.onMessage);\n        this.connection.on('read', this.onRead);\n        this.$root.api('messaging/history', { group: false }).then(userMessages => {\n            this.$root.api('messaging/history', { group: true }).then(groupMessages => {\n                const messages = userMessages.concat(groupMessages);\n                messages.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n                this.messages = messages;\n                this.fetching = false;\n            });\n        });\n    },\n    beforeDestroy() {\n        this.connection.dispose();\n    },\n    methods: {\n        getAcct,\n        isMe(message) {\n            return message.userId == this.$store.state.i.id;\n        },\n        onMessage(message) {\n            if (message.recipientId) {\n                this.messages = this.messages.filter(m => !((m.recipientId == message.recipientId && m.userId == message.userId) ||\n                    (m.recipientId == message.userId && m.userId == message.recipientId)));\n                this.messages.unshift(message);\n            }\n            else if (message.groupId) {\n                this.messages = this.messages.filter(m => m.groupId !== message.groupId);\n                this.messages.unshift(message);\n            }\n        },\n        onRead(ids) {\n            for (const id of ids) {\n                const found = this.messages.find(m => m.id == id);\n                if (found) {\n                    if (found.recipientId) {\n                        found.isRead = true;\n                    }\n                    else if (found.groupId) {\n                        found.reads.push(this.$store.state.i.id);\n                    }\n                }\n            }\n        },\n        search() {\n            if (this.q == '') {\n                this.result = [];\n                return;\n            }\n            this.$root.api('users/search', {\n                query: this.q,\n                localOnly: false,\n                limit: 10,\n                detail: false\n            }).then(users => {\n                this.result = users.filter(user => user.id != this.$store.state.i.id);\n            });\n        },\n        navigate(user) {\n            this.$emit('navigate', user);\n        },\n        navigateGroup(group) {\n            this.$emit('navigateGroup', group);\n        },\n        onSearchKeydown(e) {\n            switch (e.which) {\n                case 9: // [TAB]\n                case 40: // [↓]\n                    e.preventDefault();\n                    e.stopPropagation();\n                    this.$refs.searchResult.childNodes[0].focus();\n                    break;\n            }\n        },\n        onSearchResultKeydown(i, e) {\n            const list = this.$refs.searchResult;\n            const cancel = () => {\n                e.preventDefault();\n                e.stopPropagation();\n            };\n            switch (true) {\n                case e.which == 27: // [ESC]\n                    cancel();\n                    this.$refs.search.focus();\n                    break;\n                case e.which == 9 && e.shiftKey: // [TAB] + [Shift]\n                case e.which == 38: // [↑]\n                    cancel();\n                    (list.childNodes[i].previousElementSibling || list.childNodes[this.result.length - 1]).focus();\n                    break;\n                case e.which == 9: // [TAB]\n                case e.which == 40: // [↓]\n                    cancel();\n                    (list.childNodes[i].nextElementSibling || list.childNodes[0]).focus();\n                    break;\n            }\n        },\n        async startUser() {\n            const { result: user } = await this.$root.dialog({\n                user: {\n                    local: true\n                }\n            });\n            if (user == null)\n                return;\n            this.navigate(user);\n        },\n        async startGroup() {\n            const groups1 = await this.$root.api('users/groups/owned');\n            const groups2 = await this.$root.api('users/groups/joined');\n            const { canceled, result: group } = await this.$root.dialog({\n                type: null,\n                title: this.$t('select-group'),\n                select: {\n                    items: groups1.concat(groups2).map(group => ({\n                        value: group, text: group.name\n                    }))\n                },\n                showCancelButton: true\n            });\n            if (canceled)\n                return;\n            this.navigateGroup(group);\n        }\n    }\n});\n","import { render, staticRenderFns } from \"./messaging.vue?vue&type=template&id=79802e58&scoped=true&\"\nimport script from \"./messaging.vue?vue&type=script&lang=ts&\"\nexport * from \"./messaging.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./messaging.vue?vue&type=style&index=0&id=79802e58&lang=stylus&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"79802e58\",\n  null\n  \n)\n\nexport default component.exports","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../node_modules/postcss-loader/src/index.js??ref--1-oneOf-1-2!../../../../../../node_modules/stylus-loader/index.js!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./messaging.vue?vue&type=style&index=0&id=79802e58&lang=stylus&scoped=true&\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"be0c04aa\", content, true, {});"],"sourceRoot":""}