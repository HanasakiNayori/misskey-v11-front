(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{1130:function(e,t,s){"use strict";s.r(t);var a=s(0),i=s(812),o=s(131),r=s(119),l=s(20);const n=i.a.filter(e=>"flags"!==e.category),c=e=>{let t=Array.from(e).map(e=>e.codePointAt(0).toString(16));return t.includes("200d")||(t=t.filter(e=>"fe0f"!=e)),t=t.filter(e=>e&&e.length),t.join("-")},m=n.map(e=>({emoji:e.char,name:e.name,aliasOf:null,url:`${r.a}/${c(e.char)}.svg`}));for(const e of n)if(e.keywords)for(const t of e.keywords)m.push({emoji:e.char,name:t,aliasOf:e.name,url:`${r.a}/${c(e.char)}.svg`});m.sort((e,t)=>e.name.length-t.name.length);var h=a.default.extend({props:{type:{type:String,required:!0},q:{type:String,required:!0},textarea:{type:Object,required:!0},complete:{type:Function,required:!0},close:{type:Function,required:!0},x:{type:Number,required:!0},y:{type:Number,required:!0}},data:()=>({getStaticImageUrl:l.a,fetching:!0,users:[],hashtags:[],emojis:[],select:-1,emojilist:i.a,emojiDb:[]}),computed:{items(){return this.$refs.suggests.children},useOsDefaultEmojis(){return this.$store.state.device.useOsDefaultEmojis}},updated(){this.x+this.$el.offsetWidth>window.innerWidth?this.$el.style.left=window.innerWidth-this.$el.offsetWidth+"px":this.$el.style.left=this.x+"px",this.y+this.$el.offsetHeight>window.innerHeight?(this.$el.style.top=this.y-this.$el.offsetHeight+"px",this.$el.style.marginTop="0"):(this.$el.style.top=this.y+"px",this.$el.style.marginTop="calc(1em + 8px)")},mounted(){const e=(this.$root.getMetaSync()||{emojis:[]}).emojis||[],t=[];for(const s of e)if(t.push({name:s.name,emoji:`:${s.name}:`,url:s.url,isCustomEmoji:!0}),s.aliases)for(const e of s.aliases)t.push({name:e,aliasOf:s.name,emoji:`:${s.name}:`,url:s.url,isCustomEmoji:!0});t.sort((e,t)=>e.name.length-t.name.length),this.emojiDb=t.concat(m),this.textarea.addEventListener("keydown",this.onKeydown);for(const e of Array.from(document.querySelectorAll("body *")))e.addEventListener("mousedown",this.onMousedown);this.$nextTick(()=>{this.exec(),this.$watch("q",()=>{this.$nextTick(()=>{this.exec()})})})},beforeDestroy(){this.textarea.removeEventListener("keydown",this.onKeydown);for(const e of Array.from(document.querySelectorAll("body *")))e.removeEventListener("mousedown",this.onMousedown)},methods:{exec(){if(this.select=-1,this.$refs.suggests)for(const e of Array.from(this.items))e.removeAttribute("data-selected");if("user"==this.type){const e=`autocomplete:user:${this.q}`,t=sessionStorage.getItem(e);if(t){const e=JSON.parse(t);this.users=e,this.fetching=!1}else this.$root.api("users/search",{query:this.q,limit:10,detail:!1}).then(t=>{this.users=t,this.fetching=!1,sessionStorage.setItem(e,JSON.stringify(t))})}else if("hashtag"==this.type)if(null==this.q||""==this.q)this.hashtags=JSON.parse(localStorage.getItem("hashtags")||"[]"),this.fetching=!1;else{const e=`autocomplete:hashtag:${this.q}`,t=sessionStorage.getItem(e);if(t){const e=JSON.parse(t);this.hashtags=e,this.fetching=!1}else this.$root.api("hashtags/search",{query:this.q,limit:30}).then(t=>{this.hashtags=t,this.fetching=!1,sessionStorage.setItem(e,JSON.stringify(t))})}else if("emoji"==this.type){if(null==this.q||""==this.q)return void(this.emojis=this.emojiDb.filter(e=>e.isCustomEmoji&&!e.aliasOf).sort((e,t)=>{var s=e.name.toUpperCase(),a=t.name.toUpperCase();return s<a?-1:s>a?1:0}));const e=[],t=30;this.emojiDb.some(s=>(!s.name.startsWith(this.q)||s.aliasOf||e.some(e=>e.emoji==s.emoji)||e.push(s),e.length==t)),e.length<t&&this.emojiDb.some(s=>(s.name.startsWith(this.q)&&!e.some(e=>e.emoji==s.emoji)&&e.push(s),e.length==t)),e.length<t&&this.emojiDb.some(s=>(s.name.includes(this.q)&&!e.some(e=>e.emoji==s.emoji)&&e.push(s),e.length==t)),this.emojis=e}},onMousedown(e){Object(o.a)(this.$el,e.target)||this.$el==e.target||this.close()},onKeydown(e){const t=()=>{e.preventDefault(),e.stopPropagation()};switch(e.which){case 10:case 13:-1!==this.select?(t(),this.items[this.select].click()):this.close();break;case 27:t(),this.close();break;case 38:-1!==this.select?(t(),this.selectPrev()):this.close();break;case 9:case 40:t(),this.selectNext();break;default:e.stopPropagation(),this.textarea.focus()}},selectNext(){++this.select>=this.items.length&&(this.select=0),this.applySelect()},selectPrev(){--this.select<0&&(this.select=this.items.length-1),this.applySelect()},applySelect(){for(const e of Array.from(this.items))e.removeAttribute("data-selected");this.items[this.select].setAttribute("data-selected","true"),this.items[this.select].focus()}}}),u=(s(929),s(1)),p=Object(u.a)(h,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"mk-autocomplete",on:{contextmenu:function(e){e.preventDefault()}}},[e.users.length>0?s("ol",{ref:"suggests",staticClass:"users"},e._l(e.users,(function(t){return s("li",{attrs:{tabindex:"-1"},on:{click:function(s){return e.complete(e.type,t)},keydown:e.onKeydown}},[s("img",{staticClass:"avatar",attrs:{src:t.avatarUrl,alt:""}}),s("span",{staticClass:"name"},[s("mk-user-name",{key:t.id,attrs:{user:t}})],1),s("span",{staticClass:"username"},[e._v("@"+e._s(e._f("acct")(t)))])])})),0):e._e(),e.hashtags.length>0?s("ol",{ref:"suggests",staticClass:"hashtags"},e._l(e.hashtags,(function(t){return s("li",{attrs:{tabindex:"-1"},on:{click:function(s){return e.complete(e.type,t)},keydown:e.onKeydown}},[s("span",{staticClass:"name"},[e._v(e._s(t))])])})),0):e._e(),e.emojis.length>0?s("ol",{ref:"suggests",staticClass:"emojis"},e._l(e.emojis,(function(t){return s("li",{attrs:{tabindex:"-1"},on:{click:function(s){return e.complete(e.type,t.emoji)},keydown:e.onKeydown}},[t.isCustomEmoji?s("span",{staticClass:"emoji"},[s("img",{attrs:{src:e.$store.state.device.disableShowingAnimatedImages?e.getStaticImageUrl(t.url):t.url,alt:t.emoji}})]):e.useOsDefaultEmojis?s("span",{staticClass:"emoji"},[e._v(e._s(t.emoji))]):s("span",{staticClass:"emoji"},[s("img",{attrs:{src:t.url,alt:t.emoji}})]),s("span",{staticClass:"name",domProps:{innerHTML:e._s(t.name.replace(e.q,"<b>"+e.q+"</b>"))}}),t.aliasOf?s("span",{staticClass:"alias"},[e._v("("+e._s(t.aliasOf)+")")]):e._e()])})),0):e._e()])}),[],!1,null,"3e59c218",null);t.default=p.exports},131:function(e,t,s){"use strict";t.a=(e,t)=>{let s=t.parentNode;for(;s;){if(s==e)return!0;s=s.parentNode}return!1}},759:function(e,t,s){var a=s(930);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,s(5).default)("8c034bc6",a,!0,{})},929:function(e,t,s){"use strict";var a=s(759);s.n(a).a},930:function(e,t,s){(t=s(4)(!1)).push([e.i,".mk-autocomplete[data-v-3e59c218]{position:fixed;z-index:65535;max-width:100%;margin-top:calc(1em + 8px);overflow:hidden;background:var(--faceHeader);border:1px solid rgba(0,0,0,.1);border-radius:4px;transition:top .1s ease,left .1s ease}.mk-autocomplete>ol[data-v-3e59c218]{display:block;margin:0;padding:4px 0;max-height:190px;max-width:500px;overflow:auto;list-style:none}.mk-autocomplete>ol>li[data-v-3e59c218]{display:flex;align-items:center;padding:4px 12px;white-space:nowrap;overflow:hidden;font-size:.9em;color:rgba(0,0,0,.8);cursor:default}.mk-autocomplete>ol>li[data-v-3e59c218],.mk-autocomplete>ol>li *[data-v-3e59c218]{user-select:none}.mk-autocomplete>ol>li *[data-v-3e59c218]{overflow:hidden;text-overflow:ellipsis}.mk-autocomplete>ol>li[data-v-3e59c218]:hover{background:var(--autocompleteItemHoverBg)}.mk-autocomplete>ol>li[data-selected=true][data-v-3e59c218]{background:var(--primary)}.mk-autocomplete>ol>li[data-selected=true][data-v-3e59c218],.mk-autocomplete>ol>li[data-selected=true] *[data-v-3e59c218]{color:#fff!important}.mk-autocomplete>ol>li[data-v-3e59c218]:active{background:var(--primaryDarken10)}.mk-autocomplete>ol>li[data-v-3e59c218]:active,.mk-autocomplete>ol>li:active *[data-v-3e59c218]{color:#fff!important}.mk-autocomplete>.users>li .avatar[data-v-3e59c218]{min-width:28px;min-height:28px;max-width:28px;max-height:28px;margin:0 8px 0 0;border-radius:100%}.mk-autocomplete>.users>li .name[data-v-3e59c218]{margin:0 8px 0 0;color:var(--autocompleteItemText)}.mk-autocomplete>.users>li .username[data-v-3e59c218]{color:var(--autocompleteItemTextSub)}.mk-autocomplete>.hashtags>li .name[data-v-3e59c218]{color:var(--autocompleteItemText)}.mk-autocomplete>.emojis>li .emoji[data-v-3e59c218]{display:inline-block;margin:0 4px 0 0;width:24px}.mk-autocomplete>.emojis>li .emoji>img[data-v-3e59c218]{width:24px;vertical-align:bottom}.mk-autocomplete>.emojis>li .name[data-v-3e59c218]{color:var(--autocompleteItemText)}.mk-autocomplete>.emojis>li .alias[data-v-3e59c218]{margin:0 0 0 8px;color:var(--autocompleteItemTextSub)}",""]),e.exports=t}}]);
//# sourceMappingURL=53.11.37.1.js.map