{"version":3,"sources":["webpack:///./src/client/app/common/views/components/autocomplete.vue?0685","webpack:///./src/client/app/common/views/components/autocomplete.vue?235b","webpack:///./src/client/app/common/views/components/autocomplete.vue?84a6","webpack:///./src/client/app/common/views/components/autocomplete.vue","webpack:///./src/client/app/common/scripts/contains.ts","webpack:///./src/client/app/common/views/components/autocomplete.vue?c986","webpack:///./src/client/app/common/views/components/autocomplete.vue?51d8","webpack:///./src/client/app/common/views/components/autocomplete.vue?8eef"],"names":["lib","emojilist","filter","x","category","char2file","char","codes","Array","from","map","codePointAt","toString","includes","length","join","emjdb","emoji","name","aliasOf","url","keywords","k","push","sort","a","b","extend","props","type","String","required","q","textarea","Object","complete","Function","close","Number","y","data","getStaticImageUrl","fetching","users","hashtags","emojis","select","emojiDb","computed","this","$refs","suggests","children","$store","state","device","useOsDefaultEmojis","$el","offsetWidth","window","innerWidth","style","left","offsetHeight","innerHeight","top","marginTop","customEmojis","$root","getMetaSync","emojiDefinitions","isCustomEmoji","aliases","alias","concat","addEventListener","onKeydown","el","document","querySelectorAll","onMousedown","$nextTick","exec","$watch","removeEventListener","methods","items","removeAttribute","cacheKey","cache","sessionStorage","getItem","JSON","parse","api","query","limit","detail","then","setItem","stringify","localStorage","textA","toUpperCase","textB","matched","max","some","startsWith","e","contains","target","cancel","preventDefault","stopPropagation","which","click","selectPrev","selectNext","focus","applySelect","setAttribute","component","_vm","_h","$createElement","_c","_self","staticClass","on","$event","ref","_l","user","attrs","avatarUrl","key","id","_v","_s","_f","_e","hashtag","disableShowingAnimatedImages","domProps","replace","node","child","parentNode","parent","content","module","i","locals","exports","add","default","___CSS_LOADER_API_IMPORT___"],"mappings":"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","file":"53.11.37.1.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"mk-autocomplete\",on:{\"contextmenu\":function($event){$event.preventDefault();return (function () {})($event)}}},[(_vm.users.length > 0)?_c('ol',{ref:\"suggests\",staticClass:\"users\"},_vm._l((_vm.users),function(user){return _c('li',{attrs:{\"tabindex\":\"-1\"},on:{\"click\":function($event){return _vm.complete(_vm.type, user)},\"keydown\":_vm.onKeydown}},[_c('img',{staticClass:\"avatar\",attrs:{\"src\":user.avatarUrl,\"alt\":\"\"}}),_c('span',{staticClass:\"name\"},[_c('mk-user-name',{key:user.id,attrs:{\"user\":user}})],1),_c('span',{staticClass:\"username\"},[_vm._v(\"@\"+_vm._s(_vm._f(\"acct\")(user)))])])}),0):_vm._e(),(_vm.hashtags.length > 0)?_c('ol',{ref:\"suggests\",staticClass:\"hashtags\"},_vm._l((_vm.hashtags),function(hashtag){return _c('li',{attrs:{\"tabindex\":\"-1\"},on:{\"click\":function($event){return _vm.complete(_vm.type, hashtag)},\"keydown\":_vm.onKeydown}},[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(hashtag))])])}),0):_vm._e(),(_vm.emojis.length > 0)?_c('ol',{ref:\"suggests\",staticClass:\"emojis\"},_vm._l((_vm.emojis),function(emoji){return _c('li',{attrs:{\"tabindex\":\"-1\"},on:{\"click\":function($event){return _vm.complete(_vm.type, emoji.emoji)},\"keydown\":_vm.onKeydown}},[(emoji.isCustomEmoji)?_c('span',{staticClass:\"emoji\"},[_c('img',{attrs:{\"src\":_vm.$store.state.device.disableShowingAnimatedImages ? _vm.getStaticImageUrl(emoji.url) : emoji.url,\"alt\":emoji.emoji}})]):(!_vm.useOsDefaultEmojis)?_c('span',{staticClass:\"emoji\"},[_c('img',{attrs:{\"src\":emoji.url,\"alt\":emoji.emoji}})]):_c('span',{staticClass:\"emoji\"},[_vm._v(_vm._s(emoji.emoji))]),_c('span',{staticClass:\"name\",domProps:{\"innerHTML\":_vm._s(emoji.name.replace(_vm.q, (\"<b>\" + _vm.q + \"</b>\")))}}),(emoji.aliasOf)?_c('span',{staticClass:\"alias\"},[_vm._v(\"(\"+_vm._s(emoji.aliasOf)+\")\")]):_vm._e()])}),0):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import Vue from 'vue';\nimport { emojilist } from '../../../../../misc/emojilist';\nimport contains from '../../../common/scripts/contains';\nimport { twemojiSvgBase } from '../../../../../misc/twemoji-base';\nimport { getStaticImageUrl } from '../../../common/scripts/get-static-image-url';\nconst lib = emojilist.filter(x => x.category !== 'flags');\nconst char2file = (char) => {\n    let codes = Array.from(char).map(x => x.codePointAt(0).toString(16));\n    if (!codes.includes('200d'))\n        codes = codes.filter(x => x != 'fe0f');\n    codes = codes.filter(x => x && x.length);\n    return codes.join('-');\n};\nconst emjdb = lib.map(x => ({\n    emoji: x.char,\n    name: x.name,\n    aliasOf: null,\n    url: `${twemojiSvgBase}/${char2file(x.char)}.svg`\n}));\nfor (const x of lib) {\n    if (x.keywords) {\n        for (const k of x.keywords) {\n            emjdb.push({\n                emoji: x.char,\n                name: k,\n                aliasOf: x.name,\n                url: `${twemojiSvgBase}/${char2file(x.char)}.svg`\n            });\n        }\n    }\n}\nemjdb.sort((a, b) => a.name.length - b.name.length);\nexport default Vue.extend({\n    props: {\n        type: {\n            type: String,\n            required: true,\n        },\n        q: {\n            type: String,\n            required: true,\n        },\n        textarea: {\n            type: Object,\n            required: true,\n        },\n        complete: {\n            type: Function,\n            required: true,\n        },\n        close: {\n            type: Function,\n            required: true,\n        },\n        x: {\n            type: Number,\n            required: true,\n        },\n        y: {\n            type: Number,\n            required: true,\n        },\n    },\n    data() {\n        return {\n            getStaticImageUrl,\n            fetching: true,\n            users: [],\n            hashtags: [],\n            emojis: [],\n            select: -1,\n            emojilist,\n            emojiDb: []\n        };\n    },\n    computed: {\n        items() {\n            return this.$refs.suggests.children;\n        },\n        useOsDefaultEmojis() {\n            return this.$store.state.device.useOsDefaultEmojis;\n        }\n    },\n    updated() {\n        //#region 位置調整\n        if (this.x + this.$el.offsetWidth > window.innerWidth) {\n            this.$el.style.left = (window.innerWidth - this.$el.offsetWidth) + 'px';\n        }\n        else {\n            this.$el.style.left = this.x + 'px';\n        }\n        if (this.y + this.$el.offsetHeight > window.innerHeight) {\n            this.$el.style.top = (this.y - this.$el.offsetHeight) + 'px';\n            this.$el.style.marginTop = '0';\n        }\n        else {\n            this.$el.style.top = this.y + 'px';\n            this.$el.style.marginTop = 'calc(1em + 8px)';\n        }\n        //#endregion\n    },\n    mounted() {\n        //#region Construct Emoji DB\n        const customEmojis = (this.$root.getMetaSync() || { emojis: [] }).emojis || [];\n        const emojiDefinitions = [];\n        for (const x of customEmojis) {\n            emojiDefinitions.push({\n                name: x.name,\n                emoji: `:${x.name}:`,\n                url: x.url,\n                isCustomEmoji: true\n            });\n            if (x.aliases) {\n                for (const alias of x.aliases) {\n                    emojiDefinitions.push({\n                        name: alias,\n                        aliasOf: x.name,\n                        emoji: `:${x.name}:`,\n                        url: x.url,\n                        isCustomEmoji: true\n                    });\n                }\n            }\n        }\n        emojiDefinitions.sort((a, b) => a.name.length - b.name.length);\n        this.emojiDb = emojiDefinitions.concat(emjdb);\n        //#endregion\n        this.textarea.addEventListener('keydown', this.onKeydown);\n        for (const el of Array.from(document.querySelectorAll('body *'))) {\n            el.addEventListener('mousedown', this.onMousedown);\n        }\n        this.$nextTick(() => {\n            this.exec();\n            this.$watch('q', () => {\n                this.$nextTick(() => {\n                    this.exec();\n                });\n            });\n        });\n    },\n    beforeDestroy() {\n        this.textarea.removeEventListener('keydown', this.onKeydown);\n        for (const el of Array.from(document.querySelectorAll('body *'))) {\n            el.removeEventListener('mousedown', this.onMousedown);\n        }\n    },\n    methods: {\n        exec() {\n            this.select = -1;\n            if (this.$refs.suggests) {\n                for (const el of Array.from(this.items)) {\n                    el.removeAttribute('data-selected');\n                }\n            }\n            if (this.type == 'user') {\n                const cacheKey = `autocomplete:user:${this.q}`;\n                const cache = sessionStorage.getItem(cacheKey);\n                if (cache) {\n                    const users = JSON.parse(cache);\n                    this.users = users;\n                    this.fetching = false;\n                }\n                else {\n                    this.$root.api('users/search', {\n                        query: this.q,\n                        limit: 10,\n                        detail: false\n                    }).then(users => {\n                        this.users = users;\n                        this.fetching = false;\n                        // キャッシュ\n                        sessionStorage.setItem(cacheKey, JSON.stringify(users));\n                    });\n                }\n            }\n            else if (this.type == 'hashtag') {\n                if (this.q == null || this.q == '') {\n                    this.hashtags = JSON.parse(localStorage.getItem('hashtags') || '[]');\n                    this.fetching = false;\n                }\n                else {\n                    const cacheKey = `autocomplete:hashtag:${this.q}`;\n                    const cache = sessionStorage.getItem(cacheKey);\n                    if (cache) {\n                        const hashtags = JSON.parse(cache);\n                        this.hashtags = hashtags;\n                        this.fetching = false;\n                    }\n                    else {\n                        this.$root.api('hashtags/search', {\n                            query: this.q,\n                            limit: 30\n                        }).then(hashtags => {\n                            this.hashtags = hashtags;\n                            this.fetching = false;\n                            // キャッシュ\n                            sessionStorage.setItem(cacheKey, JSON.stringify(hashtags));\n                        });\n                    }\n                }\n            }\n            else if (this.type == 'emoji') {\n                if (this.q == null || this.q == '') {\n                    this.emojis = this.emojiDb.filter(x => x.isCustomEmoji && !x.aliasOf).sort((a, b) => {\n                        var textA = a.name.toUpperCase();\n                        var textB = b.name.toUpperCase();\n                        return (textA < textB) ? -1 : (textA > textB) ? 1 : 0;\n                    });\n                    return;\n                }\n                const matched = [];\n                const max = 30;\n                this.emojiDb.some(x => {\n                    if (x.name.startsWith(this.q) && !x.aliasOf && !matched.some(y => y.emoji == x.emoji))\n                        matched.push(x);\n                    return matched.length == max;\n                });\n                if (matched.length < max) {\n                    this.emojiDb.some(x => {\n                        if (x.name.startsWith(this.q) && !matched.some(y => y.emoji == x.emoji))\n                            matched.push(x);\n                        return matched.length == max;\n                    });\n                }\n                if (matched.length < max) {\n                    this.emojiDb.some(x => {\n                        if (x.name.includes(this.q) && !matched.some(y => y.emoji == x.emoji))\n                            matched.push(x);\n                        return matched.length == max;\n                    });\n                }\n                this.emojis = matched;\n            }\n        },\n        onMousedown(e) {\n            if (!contains(this.$el, e.target) && (this.$el != e.target))\n                this.close();\n        },\n        onKeydown(e) {\n            const cancel = () => {\n                e.preventDefault();\n                e.stopPropagation();\n            };\n            switch (e.which) {\n                case 10: // [ENTER]\n                case 13: // [ENTER]\n                    if (this.select !== -1) {\n                        cancel();\n                        this.items[this.select].click();\n                    }\n                    else {\n                        this.close();\n                    }\n                    break;\n                case 27: // [ESC]\n                    cancel();\n                    this.close();\n                    break;\n                case 38: // [↑]\n                    if (this.select !== -1) {\n                        cancel();\n                        this.selectPrev();\n                    }\n                    else {\n                        this.close();\n                    }\n                    break;\n                case 9: // [TAB]\n                case 40: // [↓]\n                    cancel();\n                    this.selectNext();\n                    break;\n                default:\n                    e.stopPropagation();\n                    this.textarea.focus();\n            }\n        },\n        selectNext() {\n            if (++this.select >= this.items.length)\n                this.select = 0;\n            this.applySelect();\n        },\n        selectPrev() {\n            if (--this.select < 0)\n                this.select = this.items.length - 1;\n            this.applySelect();\n        },\n        applySelect() {\n            for (const el of Array.from(this.items)) {\n                el.removeAttribute('data-selected');\n            }\n            this.items[this.select].setAttribute('data-selected', 'true');\n            this.items[this.select].focus();\n        }\n    }\n});\n","import mod from \"-!../../../../../../node_modules/ts-loader/index.js??ref--5-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./autocomplete.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../../../node_modules/ts-loader/index.js??ref--5-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./autocomplete.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./autocomplete.vue?vue&type=template&id=3e59c218&scoped=true&\"\nimport script from \"./autocomplete.vue?vue&type=script&lang=ts&\"\nexport * from \"./autocomplete.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./autocomplete.vue?vue&type=style&index=0&id=3e59c218&lang=stylus&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3e59c218\",\n  null\n  \n)\n\nexport default component.exports","export default (parent, child) => {\n    let node = child.parentNode;\n    while (node) {\n        if (node == parent)\n            return true;\n        node = node.parentNode;\n    }\n    return false;\n};\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../node_modules/postcss-loader/src/index.js??ref--1-oneOf-1-2!../../../../../../node_modules/stylus-loader/index.js!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./autocomplete.vue?vue&type=style&index=0&id=3e59c218&lang=stylus&scoped=true&\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"8c034bc6\", content, true, {});","import mod from \"-!../../../../../../node_modules/vue-style-loader/index.js!../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../node_modules/postcss-loader/src/index.js??ref--1-oneOf-1-2!../../../../../../node_modules/stylus-loader/index.js!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./autocomplete.vue?vue&type=style&index=0&id=3e59c218&lang=stylus&scoped=true&\"; export default mod; export * from \"-!../../../../../../node_modules/vue-style-loader/index.js!../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../node_modules/postcss-loader/src/index.js??ref--1-oneOf-1-2!../../../../../../node_modules/stylus-loader/index.js!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./autocomplete.vue?vue&type=style&index=0&id=3e59c218&lang=stylus&scoped=true&\"","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".mk-autocomplete[data-v-3e59c218]{position:fixed;z-index:65535;max-width:100%;margin-top:calc(1em + 8px);overflow:hidden;background:var(--faceHeader);border:1px solid rgba(0,0,0,.1);border-radius:4px;transition:top .1s ease,left .1s ease}.mk-autocomplete>ol[data-v-3e59c218]{display:block;margin:0;padding:4px 0;max-height:190px;max-width:500px;overflow:auto;list-style:none}.mk-autocomplete>ol>li[data-v-3e59c218]{display:flex;align-items:center;padding:4px 12px;white-space:nowrap;overflow:hidden;font-size:.9em;color:rgba(0,0,0,.8);cursor:default}.mk-autocomplete>ol>li[data-v-3e59c218],.mk-autocomplete>ol>li *[data-v-3e59c218]{user-select:none}.mk-autocomplete>ol>li *[data-v-3e59c218]{overflow:hidden;text-overflow:ellipsis}.mk-autocomplete>ol>li[data-v-3e59c218]:hover{background:var(--autocompleteItemHoverBg)}.mk-autocomplete>ol>li[data-selected=true][data-v-3e59c218]{background:var(--primary)}.mk-autocomplete>ol>li[data-selected=true][data-v-3e59c218],.mk-autocomplete>ol>li[data-selected=true] *[data-v-3e59c218]{color:#fff!important}.mk-autocomplete>ol>li[data-v-3e59c218]:active{background:var(--primaryDarken10)}.mk-autocomplete>ol>li[data-v-3e59c218]:active,.mk-autocomplete>ol>li:active *[data-v-3e59c218]{color:#fff!important}.mk-autocomplete>.users>li .avatar[data-v-3e59c218]{min-width:28px;min-height:28px;max-width:28px;max-height:28px;margin:0 8px 0 0;border-radius:100%}.mk-autocomplete>.users>li .name[data-v-3e59c218]{margin:0 8px 0 0;color:var(--autocompleteItemText)}.mk-autocomplete>.users>li .username[data-v-3e59c218]{color:var(--autocompleteItemTextSub)}.mk-autocomplete>.hashtags>li .name[data-v-3e59c218]{color:var(--autocompleteItemText)}.mk-autocomplete>.emojis>li .emoji[data-v-3e59c218]{display:inline-block;margin:0 4px 0 0;width:24px}.mk-autocomplete>.emojis>li .emoji>img[data-v-3e59c218]{width:24px;vertical-align:bottom}.mk-autocomplete>.emojis>li .name[data-v-3e59c218]{color:var(--autocompleteItemText)}.mk-autocomplete>.emojis>li .alias[data-v-3e59c218]{margin:0 0 0 8px;color:var(--autocompleteItemTextSub)}\", \"\"]);\n// Exports\nmodule.exports = exports;\n"],"sourceRoot":""}