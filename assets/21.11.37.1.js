(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{1053:function(e,a,t){"use strict";var s=t(786);t.n(s).a},1054:function(e,a,t){(a=t(4)(!1)).push([e.i,'.mk-messaging[data-compact][data-v-79802e58]{font-size:.8em}.mk-messaging[data-compact]>.history>a[data-v-79802e58]:last-child{border-bottom:none}.mk-messaging[data-compact]>.history>a:not([data-is-me]):not([data-is-read])>div[data-v-79802e58]{background-image:none;border-left:4px solid #3aa2dc}.mk-messaging[data-compact]>.history>a>div[data-v-79802e58]{padding:16px}.mk-messaging[data-compact]>.history>a>div>header>.mk-time[data-v-79802e58]{font-size:1em}.mk-messaging[data-compact]>.history>a>div>.avatar[data-v-79802e58]{width:42px;height:42px;margin:0 12px 0 0}.mk-messaging>.search[data-v-79802e58]{display:block;position:-webkit-sticky;position:sticky;top:0;left:0;z-index:1;width:100%;box-shadow:0 0 2px rgba(0,0,0,.2)}.mk-messaging>.search>.form[data-v-79802e58]{background:rgba(0,0,0,.02)}.mk-messaging>.search>.form>label[data-v-79802e58]{display:block;position:absolute;top:0;left:8px;z-index:1;height:100%;width:38px;pointer-events:none}.mk-messaging>.search>.form>label>i[data-v-79802e58]{display:block;position:absolute;top:0;right:0;bottom:0;left:0;width:1em;line-height:48px;margin:auto;color:#555}.mk-messaging>.search>.form>input[data-v-79802e58]{margin:0;padding:0 0 0 42px;width:100%;font-size:1em;line-height:48px;color:var(--faceText);outline:none;background:transparent;border:none;border-radius:5px;box-shadow:none}.mk-messaging>.search>.result[data-v-79802e58]{display:block;top:0;left:0;z-index:2;width:100%;margin:0;padding:0;background:#fff}.mk-messaging>.search>.result>.users[data-v-79802e58]{margin:0;padding:0;list-style:none}.mk-messaging>.search>.result>.users>li[data-v-79802e58]{display:inline-block;z-index:1;width:100%;padding:8px 32px;vertical-align:top;white-space:nowrap;overflow:hidden;color:rgba(0,0,0,.8);text-decoration:none;transition:none;cursor:pointer}.mk-messaging>.search>.result>.users>li[data-v-79802e58]:focus,.mk-messaging>.search>.result>.users>li[data-v-79802e58]:hover{color:#fff;background:var(--primary)}.mk-messaging>.search>.result>.users>li:focus .name[data-v-79802e58],.mk-messaging>.search>.result>.users>li:focus .username[data-v-79802e58],.mk-messaging>.search>.result>.users>li:hover .name[data-v-79802e58],.mk-messaging>.search>.result>.users>li:hover .username[data-v-79802e58]{color:#fff}.mk-messaging>.search>.result>.users>li[data-v-79802e58]:active{color:#fff;background:var(--primaryDarken10)}.mk-messaging>.search>.result>.users>li:active .name[data-v-79802e58],.mk-messaging>.search>.result>.users>li:active .username[data-v-79802e58]{color:#fff}.mk-messaging>.search>.result>.users>li .avatar[data-v-79802e58]{vertical-align:middle;min-width:32px;min-height:32px;max-width:32px;max-height:32px;margin:0 8px 0 0;border-radius:6px}.mk-messaging>.search>.result>.users>li .name[data-v-79802e58]{margin:0 8px 0 0;font-weight:400;color:rgba(0,0,0,.8)}.mk-messaging>.search>.result>.users>li .username[data-v-79802e58]{font-weight:400;color:rgba(0,0,0,.3)}.mk-messaging>.history>a[data-v-79802e58]{display:block;text-decoration:none;background:var(--face);border-bottom:1px solid var(--faceDivider)}.mk-messaging>.history>a *[data-v-79802e58]{pointer-events:none;user-select:none}.mk-messaging>.history>a[data-v-79802e58]:hover{box-shadow:inset 0 0 0 100px rgba(0,0,0,.05)}.mk-messaging>.history>a:hover .avatar[data-v-79802e58]{filter:saturate(200%)}.mk-messaging>.history>a[data-v-79802e58]:active{box-shadow:inset 0 0 0 100px rgba(0,0,0,.1)}.mk-messaging>.history>a[data-is-me][data-v-79802e58],.mk-messaging>.history>a[data-is-read][data-v-79802e58]{opacity:.8}.mk-messaging>.history>a:not([data-is-me]):not([data-is-read])>div[data-v-79802e58]{background-image:url(/assets/unread.svg);background-repeat:no-repeat;background-position:0}.mk-messaging>.history>a[data-v-79802e58]:after{content:"";display:block;clear:both}.mk-messaging>.history>a>div[data-v-79802e58]{max-width:500px;margin:0 auto;padding:20px 30px}.mk-messaging>.history>a>div[data-v-79802e58]:after{content:"";display:block;clear:both}.mk-messaging>.history>a>div>header[data-v-79802e58]{display:flex;align-items:center;margin-bottom:2px;white-space:nowrap;overflow:hidden}.mk-messaging>.history>a>div>header>.name[data-v-79802e58]{margin:0;padding:0;overflow:hidden;text-overflow:ellipsis;font-size:1em;color:var(--noteHeaderName);font-weight:700;transition:all .1s ease}.mk-messaging>.history>a>div>header>.username[data-v-79802e58]{margin:0 8px;color:var(--noteHeaderAcct)}.mk-messaging>.history>a>div>header>.mk-time[data-v-79802e58]{margin:0 0 0 auto;color:var(--noteHeaderInfo);font-size:80%}.mk-messaging>.history>a>div>.avatar[data-v-79802e58]{float:left;width:54px;height:54px;margin:0 16px 0 0;border-radius:8px;transition:all .1s ease}.mk-messaging>.history>a>div>.body>.text[data-v-79802e58]{display:block;margin:0;padding:0;overflow:hidden;overflow-wrap:break-word;font-size:1.1em;color:var(--faceText)}.mk-messaging>.history>a>div>.body>.text .me[data-v-79802e58]{opacity:.7}.mk-messaging>.history>a>div>.body>.image[data-v-79802e58]{display:block;max-width:100%;max-height:512px}.mk-messaging>.no-history[data-v-79802e58]{margin:0;padding:2em 1em;text-align:center;color:#999;font-weight:500}.mk-messaging>.fetching[data-v-79802e58]{margin:0;padding:16px;text-align:center;color:var(--text)}.mk-messaging>.fetching>[data-icon][data-v-79802e58]{margin-right:4px}@media (max-width:400px){.mk-messaging>.search>.result>.users>li[data-v-79802e58]{padding:8px 16px}.mk-messaging>.history>a:not([data-is-me]):not([data-is-read])>div[data-v-79802e58]{background-image:none;border-left:4px solid #3aa2dc}.mk-messaging>.history>a>div[data-v-79802e58]{padding:16px;font-size:14px}.mk-messaging>.history>a>div>.avatar[data-v-79802e58]{margin:0 12px 0 0}}',""]),e.exports=a},1132:function(e,a,t){"use strict";t.r(a);var s=t(0),i=t(2),r=t(3),n=t(109),o=s.default.extend({i18n:Object(r.a)("common/views/components/messaging.vue"),props:{compact:{type:Boolean,default:!1},headerTop:{type:Number,default:0}},data:()=>({fetching:!0,moreFetching:!1,messages:[],q:null,result:[],connection:null,faUser:i.fd,faUsers:i.id}),mounted(){this.connection=this.$root.stream.useSharedConnection("messagingIndex"),this.connection.on("message",this.onMessage),this.connection.on("read",this.onRead),this.$root.api("messaging/history",{group:!1}).then(e=>{this.$root.api("messaging/history",{group:!0}).then(a=>{const t=e.concat(a);t.sort((e,a)=>new Date(a.createdAt).getTime()-new Date(e.createdAt).getTime()),this.messages=t,this.fetching=!1})})},beforeDestroy(){this.connection.dispose()},methods:{getAcct:n.a,isMe(e){return e.userId==this.$store.state.i.id},onMessage(e){e.recipientId?(this.messages=this.messages.filter(a=>!(a.recipientId==e.recipientId&&a.userId==e.userId||a.recipientId==e.userId&&a.userId==e.recipientId)),this.messages.unshift(e)):e.groupId&&(this.messages=this.messages.filter(a=>a.groupId!==e.groupId),this.messages.unshift(e))},onRead(e){for(const a of e){const e=this.messages.find(e=>e.id==a);e&&(e.recipientId?e.isRead=!0:e.groupId&&e.reads.push(this.$store.state.i.id))}},search(){""!=this.q?this.$root.api("users/search",{query:this.q,localOnly:!1,limit:10,detail:!1}).then(e=>{this.result=e.filter(e=>e.id!=this.$store.state.i.id)}):this.result=[]},navigate(e){this.$emit("navigate",e)},navigateGroup(e){this.$emit("navigateGroup",e)},onSearchKeydown(e){switch(e.which){case 9:case 40:e.preventDefault(),e.stopPropagation(),this.$refs.searchResult.childNodes[0].focus()}},onSearchResultKeydown(e,a){const t=this.$refs.searchResult,s=()=>{a.preventDefault(),a.stopPropagation()};switch(!0){case 27==a.which:s(),this.$refs.search.focus();break;case 9==a.which&&a.shiftKey:case 38==a.which:s(),(t.childNodes[e].previousElementSibling||t.childNodes[this.result.length-1]).focus();break;case 9==a.which:case 40==a.which:s(),(t.childNodes[e].nextElementSibling||t.childNodes[0]).focus()}},async startUser(){const{result:e}=await this.$root.dialog({user:{local:!0}});null!=e&&this.navigate(e)},async startGroup(){const e=await this.$root.api("users/groups/owned"),a=await this.$root.api("users/groups/joined"),{canceled:t,result:s}=await this.$root.dialog({type:null,title:this.$t("select-group"),select:{items:e.concat(a).map(e=>({value:e,text:e.name}))},showCancelButton:!0});t||this.navigateGroup(s)}}}),d=(t(1053),t(1)),c=Object(d.a)(o,(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"mk-messaging",attrs:{"data-compact":e.compact}},[e.compact?e._e():t("div",{staticClass:"search",style:{top:e.headerTop+"px"}},[t("div",{staticClass:"form"},[t("label",{attrs:{for:"search-input"}},[t("i",[t("fa",{attrs:{icon:"search"}})],1)]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.q,expression:"q"}],attrs:{type:"search",placeholder:e.$t("search-user")},domProps:{value:e.q},on:{input:[function(a){a.target.composing||(e.q=a.target.value)},e.search],keydown:e.onSearchKeydown}})]),t("div",{staticClass:"result"},[e.result.length>0?t("ol",{ref:"searchResult",staticClass:"users"},e._l(e.result,(function(a,s){return t("li",{attrs:{tabindex:"-1"},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.navigate(a)},function(a){return e.onSearchResultKeydown(s)}],click:function(t){return e.navigate(a)}}},[t("mk-avatar",{key:a.id,staticClass:"avatar",attrs:{user:a}}),t("span",{staticClass:"name"},[t("mk-user-name",{key:a.id,attrs:{user:a}})],1),t("span",{staticClass:"username"},[e._v("@"+e._s(e._f("acct")(a)))])],1)})),0):e._e()])]),e.messages.length>0?t("div",{staticClass:"history"},e._l(e.messages,(function(a){return t("a",{key:a.id,staticClass:"user",attrs:{href:a.groupId?"/i/messaging/group/"+a.groupId:"/i/messaging/"+e.getAcct(e.isMe(a)?a.recipient:a.user),"data-is-me":e.isMe(a),"data-is-read":a.groupId?a.reads.includes(e.$store.state.i.id):a.isRead},on:{click:function(t){t.preventDefault(),a.groupId?e.navigateGroup(a.group):e.navigate(e.isMe(a)?a.recipient:a.user)}}},[t("div",[t("mk-avatar",{staticClass:"avatar",attrs:{user:a.groupId?a.user:e.isMe(a)?a.recipient:a.user}}),a.groupId?t("header",[t("span",{staticClass:"name"},[e._v(e._s(a.group.name))]),t("mk-time",{attrs:{time:a.createdAt}})],1):t("header",[t("span",{staticClass:"name"},[t("mk-user-name",{attrs:{user:e.isMe(a)?a.recipient:a.user}})],1),t("span",{staticClass:"username"},[e._v("@"+e._s(e._f("acct")(e.isMe(a)?a.recipient:a.user)))]),t("mk-time",{attrs:{time:a.createdAt}})],1),t("div",{staticClass:"body"},[t("p",{staticClass:"text"},[e.isMe(a)?t("span",{staticClass:"me"},[e._v(e._s(e.$t("you"))+":")]):e._e(),e._v(e._s(a.text))])])],1)])})),0):e._e(),e.fetching||0!=e.messages.length?e._e():t("p",{staticClass:"no-history"},[e._v(e._s(e.$t("no-history")))]),e.fetching?t("p",{staticClass:"fetching"},[t("fa",{attrs:{icon:"spinner",pulse:"","fixed-width":""}}),e._v(e._s(e.$t("@.loading"))),t("mk-ellipsis")],1):e._e(),t("ui-margin",[t("ui-button",{on:{click:function(a){return e.startUser()}}},[t("fa",{attrs:{icon:e.faUser}}),e._v(" "+e._s(e.$t("start-with-user")))],1),t("ui-button",{on:{click:function(a){return e.startGroup()}}},[t("fa",{attrs:{icon:e.faUsers}}),e._v(" "+e._s(e.$t("start-with-group")))],1)],1)],1)}),[],!1,null,"79802e58",null);a.default=c.exports},786:function(e,a,t){var s=t(1054);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,t(5).default)("be0c04aa",s,!0,{})}}]);
//# sourceMappingURL=21.11.37.1.js.map