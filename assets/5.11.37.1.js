(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1006:function(e,t,i){"use strict";var a=i(764);i.n(a).a},1007:function(e,t,i){(t=i(4)(!1)).push([e.i,".root.nav-folder>*[data-v-bc9dcd2c]{pointer-events:none}.root.nav-folder[data-draghover][data-v-bc9dcd2c]{background:#eee}.root.nav-folder i.cloud[data-v-bc9dcd2c]{margin-right:4px}",""]),e.exports=t},1008:function(e,t,i){"use strict";var a=i(765);i.n(a).a},1009:function(e,t,i){(t=i(4)(!1)).push([e.i,'.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-v-009c4c3a]{padding:8px;height:64px;background:var(--desktopDriveFolderBg);border-radius:4px}.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-v-009c4c3a],.ynntpczxvnusfwdyxsfuhvcmuypqopdd *[data-v-009c4c3a]{cursor:pointer}.ynntpczxvnusfwdyxsfuhvcmuypqopdd *[data-v-009c4c3a]{pointer-events:none}.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-v-009c4c3a]:hover{background:var(--desktopDriveFolderHoverBg)}.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-v-009c4c3a]:active{background:var(--desktopDriveFolderActiveBg)}.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-draghover][data-v-009c4c3a]:after,.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-is-contextmenu-showing][data-v-009c4c3a]:after{content:"";pointer-events:none;position:absolute;top:-4px;right:-4px;bottom:-4px;left:-4px;border:2px dashed var(--primaryAlpha03);border-radius:4px}.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-draghover][data-v-009c4c3a]{background:var(--desktopDriveFolderActiveBg)}.ynntpczxvnusfwdyxsfuhvcmuypqopdd>.name[data-v-009c4c3a]{margin:0;font-size:.9em;color:var(--desktopDriveFolderFg)}.ynntpczxvnusfwdyxsfuhvcmuypqopdd>.name>[data-icon][data-v-009c4c3a]{margin-right:4px;margin-left:2px;text-align:left}.ynntpczxvnusfwdyxsfuhvcmuypqopdd>.upload[data-v-009c4c3a]{margin:4px;font-size:.8em;text-align:right;color:var(--desktopDriveFolderFg)}',""]),e.exports=t},1010:function(e,t,i){"use strict";var a=i(766);i.n(a).a},1011:function(e,t,i){(t=i(4)(!1)).push([e.i,'.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-v-42183f7b]{padding:8px 0 0;min-height:180px;border-radius:4px}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-v-42183f7b],.gvfdktuvdgwhmztnuekzkswkjygptfcv *[data-v-42183f7b]{cursor:pointer}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-v-42183f7b]:hover{background:rgba(0,0,0,.05)}.gvfdktuvdgwhmztnuekzkswkjygptfcv:hover>.label[data-v-42183f7b]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv:hover>.label[data-v-42183f7b]:before{background:#0b65a5}.gvfdktuvdgwhmztnuekzkswkjygptfcv:hover>.label.red[data-v-42183f7b]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv:hover>.label.red[data-v-42183f7b]:before{background:#c12113}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-v-42183f7b]:active{background:rgba(0,0,0,.1)}.gvfdktuvdgwhmztnuekzkswkjygptfcv:active>.label[data-v-42183f7b]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv:active>.label[data-v-42183f7b]:before{background:#0b588c}.gvfdktuvdgwhmztnuekzkswkjygptfcv:active>.label.red[data-v-42183f7b]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv:active>.label.red[data-v-42183f7b]:before{background:#ce2212}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected][data-v-42183f7b]{background:var(--primary)}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected][data-v-42183f7b]:hover{background:var(--primaryLighten10)}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected][data-v-42183f7b]:active{background:var(--primaryDarken10)}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected]>.label[data-v-42183f7b]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected]>.label[data-v-42183f7b]:before{display:none}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected]>.name[data-v-42183f7b],.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected]>.thumbnail[data-v-42183f7b]{color:var(--primaryForeground)}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-contextmenu-showing][data-v-42183f7b]:after{content:"";pointer-events:none;position:absolute;top:-4px;right:-4px;bottom:-4px;left:-4px;border:2px dashed var(--primaryAlpha03);border-radius:4px}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label[data-v-42183f7b]{position:absolute;top:0;left:0;pointer-events:none}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label[data-v-42183f7b]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label[data-v-42183f7b]:before{content:"";display:block;position:absolute;z-index:1;background:#0c7ac9}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label[data-v-42183f7b]:before{top:0;left:57px;width:28px;height:8px}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label[data-v-42183f7b]:after{top:57px;left:0;width:8px;height:28px}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label.red[data-v-42183f7b]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label.red[data-v-42183f7b]:before{background:#c12113}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label>img[data-v-42183f7b]{position:absolute;z-index:2;top:0;left:0}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label>p[data-v-42183f7b]{position:absolute;z-index:3;top:19px;left:-28px;width:120px;margin:0;text-align:center;line-height:28px;color:#fff;transform:rotate(-45deg)}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.thumbnail[data-v-42183f7b]{width:128px;height:128px;margin:auto;color:var(--driveFileIcon)}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.name[data-v-42183f7b]{display:block;margin:4px 0 0;font-size:.8em;text-align:center;word-break:break-all;color:var(--text);overflow:hidden}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.name>.ext[data-v-42183f7b]{opacity:.5}',""]),e.exports=t},1012:function(e,t,i){"use strict";var a=i(767);i.n(a).a},1013:function(e,t,i){(t=i(4)(!1)).push([e.i,".mk-drive>nav[data-v-fae14316]{display:block;z-index:2;width:100%;overflow:auto;font-size:.9em;color:var(--text);background:var(--face);box-shadow:0 1px 0 rgba(0,0,0,.05)}.mk-drive>nav[data-v-fae14316],.mk-drive>nav *[data-v-fae14316]{user-select:none}.mk-drive>nav>.path[data-v-fae14316]{vertical-align:bottom;width:calc(100% - 200px);white-space:nowrap}.mk-drive>nav>.path[data-v-fae14316],.mk-drive>nav>.path>*[data-v-fae14316]{display:inline-block;margin:0;padding:0 8px;line-height:38px}.mk-drive>nav>.path>*[data-v-fae14316]{cursor:pointer}.mk-drive>nav>.path>* *[data-v-fae14316]{pointer-events:none}.mk-drive>nav>.path[data-v-fae14316]>:hover{text-decoration:underline}.mk-drive>nav>.path>.current[data-v-fae14316]{font-weight:700;cursor:default}.mk-drive>nav>.path>.current[data-v-fae14316]:hover{text-decoration:none}.mk-drive>nav>.path>.separator[data-v-fae14316]{margin:0;padding:0;opacity:.5;cursor:default}.mk-drive>nav>.path>.separator>[data-icon][data-v-fae14316]{margin:0}.mk-drive>.main[data-v-fae14316]{padding:8px;height:calc(100% - 38px);overflow:auto;background:var(--desktopDriveBg)}.mk-drive>.main[data-v-fae14316],.mk-drive>.main *[data-v-fae14316]{user-select:none}.mk-drive>.main.fetching[data-v-fae14316]{cursor:wait!important}.mk-drive>.main.fetching *[data-v-fae14316]{pointer-events:none}.mk-drive>.main.fetching>.contents[data-v-fae14316]{opacity:.5}.mk-drive>.main.uploading[data-v-fae14316]{height:calc(100% - 138px)}.mk-drive>.main>.selection[data-v-fae14316]{display:none;position:absolute;z-index:128;top:0;left:0;border:1px solid var(--primary);background:var(--primaryAlpha05);pointer-events:none}.mk-drive>.main>.contents>.files[data-v-fae14316],.mk-drive>.main>.contents>.folders[data-v-fae14316]{display:flex;flex-wrap:wrap}.mk-drive>.main>.contents>.files>.file[data-v-fae14316],.mk-drive>.main>.contents>.files>.folder[data-v-fae14316],.mk-drive>.main>.contents>.folders>.file[data-v-fae14316],.mk-drive>.main>.contents>.folders>.folder[data-v-fae14316]{flex-grow:1;width:144px;margin:4px}.mk-drive>.main>.contents>.files>.padding[data-v-fae14316],.mk-drive>.main>.contents>.folders>.padding[data-v-fae14316]{flex-grow:1;pointer-events:none;width:152px}.mk-drive>.main>.contents>.empty[data-v-fae14316]{padding:16px;text-align:center;color:#999;pointer-events:none}.mk-drive>.main>.contents>.empty>p[data-v-fae14316]{margin:0}.mk-drive>.main>.fetching .spinner[data-v-fae14316]{margin:100px auto;width:40px;height:40px;text-align:center;animation:sk-rotate-data-v-fae14316 2s linear infinite}.mk-drive>.main>.fetching .dot1[data-v-fae14316],.mk-drive>.main>.fetching .dot2[data-v-fae14316]{width:60%;height:60%;display:inline-block;position:absolute;top:0;background-color:rgba(0,0,0,.3);border-radius:100%;animation:sk-bounce-data-v-fae14316 2s ease-in-out infinite}.mk-drive>.main>.fetching .dot2[data-v-fae14316]{top:auto;bottom:0;animation-delay:-1s}@-moz-keyframes sk-rotate-data-v-fae14316{to{transform:rotate(1turn)}}@-webkit-keyframes sk-rotate-data-v-fae14316{to{transform:rotate(1turn)}}@-o-keyframes sk-rotate-data-v-fae14316{to{transform:rotate(1turn)}}@keyframes sk-rotate-data-v-fae14316{to{transform:rotate(1turn)}}@-moz-keyframes sk-bounce-data-v-fae14316{0%,to{transform:scale(0)}50%{transform:scale(1)}}@-webkit-keyframes sk-bounce-data-v-fae14316{0%,to{transform:scale(0)}50%{transform:scale(1)}}@-o-keyframes sk-bounce-data-v-fae14316{0%,to{transform:scale(0)}50%{transform:scale(1)}}@keyframes sk-bounce-data-v-fae14316{0%,to{transform:scale(0)}50%{transform:scale(1)}}.mk-drive>.dropzone[data-v-fae14316]{position:absolute;left:0;top:38px;width:100%;height:calc(100% - 38px);border:2px dashed var(--primaryAlpha05);pointer-events:none}.mk-drive>.mk-uploader[data-v-fae14316]{height:100px;padding:16px}.mk-drive>input[data-v-fae14316]{display:none}",""]),e.exports=t},1099:function(e,t,i){"use strict";i.r(t);var a=i(0),o=i(3),r=i(430),s=a.default.extend({i18n:Object(o.a)(),props:["folder"],data:()=>({hover:!1,draghover:!1}),computed:{browser(){return this.$parent}},methods:{onClick(){this.browser.move(this.folder)},onMouseover(){this.hover=!0},onMouseout(){this.hover=!1},onDragover(e){null==this.folder&&null==this.browser.folder&&(e.dataTransfer.dropEffect="none");const t="file"==e.dataTransfer.items[0].kind,i="mk_drive_file"==e.dataTransfer.types[0],a="mk_drive_folder"==e.dataTransfer.types[0];return e.dataTransfer.dropEffect=t||i||a?"all"==e.dataTransfer.effectAllowed?"copy":"move":"none",!1},onDragenter(){(this.folder||this.browser.folder)&&(this.draghover=!0)},onDragleave(){(this.folder||this.browser.folder)&&(this.draghover=!1)},onDrop(e){if(this.draghover=!1,e.dataTransfer.files.length>0){for(const t of Array.from(e.dataTransfer.files))this.browser.upload(t,this.folder);return}const t=e.dataTransfer.getData("mk_drive_file");if(null!=t&&""!=t){const e=JSON.parse(t);this.browser.removeFile(e.id),this.$root.api("drive/files/update",{fileId:e.id,folderId:this.folder?this.folder.id:null})}const i=e.dataTransfer.getData("mk_drive_folder");if(null!=i&&""!=i){const e=JSON.parse(i);if(this.folder&&e.id==this.folder.id)return;this.browser.removeFolder(e.id),this.$root.api("drive/folders/update",{folderId:e.id,parentId:this.folder?this.folder.id:null})}}}}),n=(i(1006),i(1)),d=Object(n.a)(s,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"root nav-folder",attrs:{"data-draghover":e.draghover},on:{click:e.onClick,dragover:function(t){return t.preventDefault(),t.stopPropagation(),e.onDragover(t)},dragenter:e.onDragenter,dragleave:e.onDragleave,drop:function(t){return t.stopPropagation(),e.onDrop(t)}}},[null==e.folder?i("i",{staticClass:"cloud"},[i("fa",{attrs:{icon:"cloud"}})],1):e._e(),i("span",[e._v(e._s(null==e.folder?e.$t("@.drive"):e.folder.name))])])}),[],!1,null,"bc9dcd2c",null).exports,l=a.default.extend({i18n:Object(o.a)("desktop/views/components/drive.folder.vue"),props:["folder"],data:()=>({hover:!1,draghover:!1,isDragging:!1,isContextmenuShowing:!1}),computed:{browser(){return this.$parent},title(){return this.folder.name}},methods:{onClick(){this.browser.move(this.folder)},onContextmenu(e){this.isContextmenuShowing=!0,this.$contextmenu(e,[{type:"item",text:this.$t("contextmenu.move-to-this-folder"),icon:"arrow-right",action:this.go},{type:"item",text:this.$t("contextmenu.show-in-new-window"),icon:["far","window-restore"],action:this.newWindow},null,{type:"item",text:this.$t("contextmenu.rename"),icon:"i-cursor",action:this.rename},null,{type:"item",text:this.$t("@.delete"),icon:["far","trash-alt"],action:this.deleteFolder},null,{type:"nest",text:this.$t("contextmenu.else-folders"),menu:[{type:"item",text:this.$t("contextmenu.set-as-upload-folder"),action:this.setAsUploadFolder}]}],{closed:()=>{this.isContextmenuShowing=!1}})},onMouseover(){this.hover=!0},onMouseout(){this.hover=!1},onDragover(e){if(this.isDragging)return void(e.dataTransfer.dropEffect="none");const t="file"==e.dataTransfer.items[0].kind,i="mk_drive_file"==e.dataTransfer.types[0],a="mk_drive_folder"==e.dataTransfer.types[0];e.dataTransfer.dropEffect=t||i||a?"all"==e.dataTransfer.effectAllowed?"copy":"move":"none"},onDragenter(){this.isDragging||(this.draghover=!0)},onDragleave(){this.draghover=!1},onDrop(e){if(this.draghover=!1,e.dataTransfer.files.length>0){for(const t of Array.from(e.dataTransfer.files))this.browser.upload(t,this.folder);return}const t=e.dataTransfer.getData("mk_drive_file");if(null!=t&&""!=t){const e=JSON.parse(t);this.browser.removeFile(e.id),this.$root.api("drive/files/update",{fileId:e.id,folderId:this.folder.id})}const i=e.dataTransfer.getData("mk_drive_folder");if(null!=i&&""!=i){const e=JSON.parse(i);if(e.id==this.folder.id)return;this.browser.removeFolder(e.id),this.$root.api("drive/folders/update",{folderId:e.id,parentId:this.folder.id}).then(()=>{}).catch(e=>{switch(e){case"detected-circular-definition":this.$root.dialog({title:this.$t("unable-to-process"),text:this.$t("circular-reference-detected")});break;default:this.$root.dialog({type:"error",text:this.$t("unhandled-error")})}})}},onDragstart(e){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("mk_drive_folder",JSON.stringify(this.folder)),this.isDragging=!0,this.browser.isDragSource=!0},onDragend(){this.isDragging=!1,this.browser.isDragSource=!1},go(){this.browser.move(this.folder.id)},newWindow(){this.browser.newWindow(this.folder)},rename(){this.$root.dialog({title:this.$t("contextmenu.rename-folder"),input:{placeholder:this.$t("contextmenu.input-new-folder-name"),default:this.folder.name}}).then(({canceled:e,result:t})=>{e||this.$root.api("drive/folders/update",{folderId:this.folder.id,name:t})})},deleteFolder(){this.$root.api("drive/folders/delete",{folderId:this.folder.id}).then(()=>{this.$store.state.settings.uploadFolder===this.folder.id&&this.$store.dispatch("settings/set",{key:"uploadFolder",value:null})}).catch(e=>{switch(e.id){case"b0fc8a17-963c-405d-bfbc-859a487295e1":this.$root.dialog({type:"error",title:this.$t("unable-to-delete"),text:this.$t("has-child-files-or-folders")});break;default:this.$root.dialog({type:"error",text:this.$t("unable-to-delete")})}})},setAsUploadFolder(){this.$store.dispatch("settings/set",{key:"uploadFolder",value:this.folder.id})}}}),f=(i(1008),Object(n.a)(l,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ynntpczxvnusfwdyxsfuhvcmuypqopdd",attrs:{"data-is-contextmenu-showing":e.isContextmenuShowing,"data-draghover":e.draghover,draggable:"true",title:e.title},on:{click:e.onClick,mouseover:e.onMouseover,mouseout:e.onMouseout,dragover:function(t){return t.preventDefault(),t.stopPropagation(),e.onDragover(t)},dragenter:function(t){return t.preventDefault(),e.onDragenter(t)},dragleave:e.onDragleave,drop:function(t){return t.preventDefault(),t.stopPropagation(),e.onDrop(t)},dragstart:e.onDragstart,dragend:e.onDragend,contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.onContextmenu(t)}}},[i("p",{staticClass:"name"},[e.hover?[i("fa",{attrs:{icon:["far","folder-open"],"fixed-width":""}})]:e._e(),e.hover?e._e():[i("fa",{attrs:{icon:["far","folder"],"fixed-width":""}})],e._v("\n\t\t"+e._s(e.folder.name)+"\n\t")],2),e.$store.state.settings.uploadFolder==e.folder.id?i("p",{staticClass:"upload"},[e._v("\n\t\t"+e._s(e.$t("upload-folder"))+"\n\t")]):e._e()])}),[],!1,null,"009c4c3a",null).exports),c=i(315),h=i(460),p=i(461),v=i(455),u=a.default.extend({i18n:Object(o.a)("desktop/views/components/drive.file.vue"),props:["file"],components:{XFileThumbnail:v.a},data:()=>({isContextmenuShowing:!1,isDragging:!1}),computed:{browser(){return this.$parent},isSelected(){return this.browser.selectedFiles.some(e=>e.id==this.file.id)},title(){return`${this.file.name}\n${this.file.type} ${a.default.filter("bytes")(this.file.size)}`}},methods:{onClick(){this.browser.chooseFile(this.file)},onContextmenu(e){this.isContextmenuShowing=!0,this.$contextmenu(e,[{type:"item",text:this.$t("contextmenu.rename"),icon:"i-cursor",action:this.rename},{type:"item",text:this.file.isSensitive?this.$t("contextmenu.unmark-as-sensitive"):this.$t("contextmenu.mark-as-sensitive"),icon:this.file.isSensitive?["far","eye"]:["far","eye-slash"],action:this.toggleSensitive},null,{type:"item",text:this.$t("contextmenu.copy-url"),icon:"link",action:this.copyUrl},{type:"link",href:this.file.url,target:"_blank",text:this.$t("contextmenu.download"),icon:"download",download:this.file.name},null,{type:"item",text:this.$t("@.delete"),icon:["far","trash-alt"],action:this.deleteFile},null,{type:"nest",text:this.$t("contextmenu.else-files"),menu:[{type:"item",text:this.$t("contextmenu.set-as-avatar"),action:this.setAsAvatar},{type:"item",text:this.$t("contextmenu.set-as-banner"),action:this.setAsBanner}]}],{closed:()=>{this.isContextmenuShowing=!1}})},onDragstart(e){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("mk_drive_file",JSON.stringify(this.file)),this.isDragging=!0,this.browser.isDragSource=!0},onDragend(e){this.isDragging=!1,this.browser.isDragSource=!1},onThumbnailLoaded(){this.file.properties.avgColor&&anime({targets:this.$refs.thumbnail,backgroundColor:"transparent",duration:100,easing:"linear"})},rename(){this.$root.dialog({title:this.$t("contextmenu.rename-file"),input:{placeholder:this.$t("contextmenu.input-new-file-name"),default:this.file.name,allowEmpty:!1}}).then(({canceled:e,result:t})=>{e||this.$root.api("drive/files/update",{fileId:this.file.id,name:t})})},toggleSensitive(){this.$root.api("drive/files/update",{fileId:this.file.id,isSensitive:!this.file.isSensitive})},copyUrl(){Object(c.a)(this.file.url),this.$root.dialog({title:this.$t("contextmenu.copied"),text:this.$t("contextmenu.copied-url-to-clipboard")})},setAsAvatar(){Object(h.a)(this.$root)(this.file)},setAsBanner(){Object(p.a)(this.$root)(this.file)},addApp(){alert("not implemented yet")},deleteFile(){this.$root.api("drive/files/delete",{fileId:this.file.id})}}}),m=(i(1010),Object(n.a)(u,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"gvfdktuvdgwhmztnuekzkswkjygptfcv",attrs:{"data-is-selected":e.isSelected,"data-is-contextmenu-showing":e.isContextmenuShowing,draggable:"true",title:e.title},on:{click:e.onClick,dragstart:e.onDragstart,dragend:e.onDragend,contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.onContextmenu(t)}}},[e.$store.state.i.avatarId==e.file.id?i("div",{staticClass:"label"},[i("img",{attrs:{src:"/assets/label.svg"}}),i("p",[e._v(e._s(e.$t("avatar")))])]):e._e(),e.$store.state.i.bannerId==e.file.id?i("div",{staticClass:"label"},[i("img",{attrs:{src:"/assets/label.svg"}}),i("p",[e._v(e._s(e.$t("banner")))])]):e._e(),e.file.isSensitive?i("div",{staticClass:"label red"},[i("img",{attrs:{src:"/assets/label-red.svg"}}),i("p",[e._v(e._s(e.$t("nsfw")))])]):e._e(),i("x-file-thumbnail",{staticClass:"thumbnail",attrs:{file:e.file,fit:"contain"}}),i("p",{staticClass:"name"},[i("span",[e._v(e._s(-1!=e.file.name.lastIndexOf(".")?e.file.name.substr(0,e.file.name.lastIndexOf(".")):e.file.name))]),-1!=e.file.name.lastIndexOf(".")?i("span",{staticClass:"ext"},[e._v(e._s(e.file.name.substr(e.file.name.lastIndexOf("."))))]):e._e()])],1)}),[],!1,null,"42183f7b",null).exports),g=i(131),k=i(6),b=i(2),x=a.default.extend({i18n:Object(o.a)("desktop/views/components/drive.vue"),components:{XNavFolder:d,XFolder:f,XFile:m},props:{initFolder:{type:Object,required:!1},type:{type:String,required:!1,default:void 0},multiple:{type:Boolean,default:!1}},data:()=>({folder:null,files:[],folders:[],moreFiles:!1,moreFolders:!1,hierarchyFolders:[],selectedFiles:[],uploadings:[],connection:null,draghover:!1,isDragSource:!1,fetching:!0}),mounted(){this.connection=this.$root.stream.useSharedConnection("drive"),this.connection.on("fileCreated",this.onStreamDriveFileCreated),this.connection.on("fileUpdated",this.onStreamDriveFileUpdated),this.connection.on("fileDeleted",this.onStreamDriveFileDeleted),this.connection.on("folderCreated",this.onStreamDriveFolderCreated),this.connection.on("folderUpdated",this.onStreamDriveFolderUpdated),this.connection.on("folderDeleted",this.onStreamDriveFolderDeleted),this.initFolder?this.move(this.initFolder):this.fetch()},beforeDestroy(){this.connection.dispose()},methods:{onContextmenu(e){this.$contextmenu(e,[{type:"item",text:this.$t("contextmenu.create-folder"),icon:["far","folder"],action:this.createFolder},{type:"item",text:this.$t("contextmenu.upload"),icon:"upload",action:this.selectLocalFile},{type:"item",text:this.$t("contextmenu.url-upload"),icon:b.L,action:this.urlUpload}])},onStreamDriveFileCreated(e){this.addFile(e,!0)},onStreamDriveFileUpdated(e){(this.folder?this.folder.id:null)!=e.folderId?this.removeFile(e):this.addFile(e,!0)},onStreamDriveFileDeleted(e){this.removeFile(e)},onStreamDriveFolderCreated(e){this.addFolder(e,!0)},onStreamDriveFolderUpdated(e){(this.folder?this.folder.id:null)!=e.parentId?this.removeFolder(e):this.addFolder(e,!0)},onStreamDriveFolderDeleted(e){this.removeFolder(e)},onChangeUploaderUploads(e){this.uploadings=e},onUploaderUploaded(e){this.addFile(e,!0)},onMousedown(e){if(Object(g.a)(this.$refs.foldersContainer,e.target)||Object(g.a)(this.$refs.filesContainer,e.target))return!0;const t=this.$refs.main,i=this.$refs.selection,a=t.getBoundingClientRect(),o=e.pageX+t.scrollLeft-a.left-window.pageXOffset,r=e.pageY+t.scrollTop-a.top-window.pageYOffset,s=e=>{i.style.display="block";const s=e.pageX+t.scrollLeft-a.left-window.pageXOffset,n=e.pageY+t.scrollTop-a.top-window.pageYOffset,d=s-o,l=n-r;d>0?(i.style.width=d+"px",i.style.left=o+"px"):(i.style.width=-d+"px",i.style.left=s+"px"),l>0?(i.style.height=l+"px",i.style.top=r+"px"):(i.style.height=-l+"px",i.style.top=n+"px")},n=e=>{document.documentElement.removeEventListener("mousemove",s),document.documentElement.removeEventListener("mouseup",n),i.style.display="none"};document.documentElement.addEventListener("mousemove",s),document.documentElement.addEventListener("mouseup",n)},onDragover(e){if(this.isDragSource)return void(e.dataTransfer.dropEffect="none");const t="file"==e.dataTransfer.items[0].kind,i="mk_drive_file"==e.dataTransfer.types[0],a="mk_drive_folder"==e.dataTransfer.types[0];return e.dataTransfer.dropEffect=t||i||a?"all"==e.dataTransfer.effectAllowed?"copy":"move":"none",!1},onDragenter(e){this.isDragSource||(this.draghover=!0)},onDragleave(e){this.draghover=!1},onDrop(e){if(this.draghover=!1,e.dataTransfer.files.length>0){for(const t of Array.from(e.dataTransfer.files))this.upload(t,this.folder);return}const t=e.dataTransfer.getData("mk_drive_file");if(null!=t&&""!=t){const e=JSON.parse(t);if(this.files.some(t=>t.id==e.id))return;this.removeFile(e.id),this.$root.api("drive/files/update",{fileId:e.id,folderId:this.folder?this.folder.id:null})}const i=e.dataTransfer.getData("mk_drive_folder");if(null!=i&&""!=i){const e=JSON.parse(i);if(this.folder&&e.id==this.folder.id)return!1;if(this.folders.some(t=>t.id==e.id))return!1;this.removeFolder(e.id),this.$root.api("drive/folders/update",{folderId:e.id,parentId:this.folder?this.folder.id:null}).then(()=>{}).catch(e=>{switch(e){case"detected-circular-definition":this.$root.dialog({title:this.$t("unable-to-process"),text:this.$t("circular-reference-detected")});break;default:this.$root.dialog({type:"error",text:this.$t("unhandled-error")})}})}},selectLocalFile(){this.$refs.fileInput.click()},urlUpload(){this.$root.dialog({title:this.$t("url-upload"),input:{placeholder:this.$t("url-of-file")}}).then(({canceled:e,result:t})=>{e||(this.$root.api("drive/files/upload_from_url",{url:t,folderId:this.folder?this.folder.id:void 0}),this.$root.dialog({title:this.$t("url-upload-requested"),text:this.$t("may-take-time")}))})},createFolder(){this.$root.dialog({title:this.$t("create-folder"),input:{placeholder:this.$t("folder-name")}}).then(({canceled:e,result:t})=>{e||this.$root.api("drive/folders/create",{name:t,parentId:this.folder?this.folder.id:void 0}).then(e=>{this.addFolder(e,!0)})})},onChangeFileInput(){for(const e of Array.from(this.$refs.fileInput.files))this.upload(e,this.folder)},upload(e,t){t&&"object"==typeof t&&(t=t.id),this.$refs.uploader.upload(e,t)},chooseFile(e){const t=this.selectedFiles.some(t=>t.id==e.id);this.multiple?(t?this.selectedFiles=this.selectedFiles.filter(t=>t.id!=e.id):this.selectedFiles.push(e),this.$emit("change-selection",this.selectedFiles)):t?this.$emit("selected",e):(this.selectedFiles=[e],this.$emit("change-selection",[e]))},newWindow(e){document.body.clientWidth>800?this.$root.new(r.a,{folder:e}):window.open(`${k.k}/i/drive/folder/${e.id}`,"drive_window","height=500, width=800")},move(e){null!=e?("object"==typeof e&&(e=e.id),this.fetching=!0,this.$root.api("drive/folders/show",{folderId:e}).then(e=>{this.folder=e,this.hierarchyFolders=[];const t=e=>{this.hierarchyFolders.unshift(e),e.parent&&t(e.parent)};e.parent&&t(e.parent),this.$emit("open-folder",e),this.fetch()})):this.goRoot()},addFolder(e,t=!1){if((this.folder?this.folder.id:null)==e.parentId)if(this.folders.some(t=>t.id==e.id)){const t=this.folders.map(e=>e.id).indexOf(e.id);a.default.set(this.folders,t,e)}else t?this.folders.unshift(e):this.folders.push(e)},addFile(e,t=!1){if((this.folder?this.folder.id:null)==e.folderId)if(this.files.some(t=>t.id==e.id)){const t=this.files.map(e=>e.id).indexOf(e.id);a.default.set(this.files,t,e)}else t?this.files.unshift(e):this.files.push(e)},removeFolder(e){"object"==typeof e&&(e=e.id),this.folders=this.folders.filter(t=>t.id!=e)},removeFile(e){"object"==typeof e&&(e=e.id),this.files=this.files.filter(t=>t.id!=e)},appendFile(e){this.addFile(e)},appendFolder(e){this.addFolder(e)},prependFile(e){this.addFile(e,!0)},prependFolder(e){this.addFolder(e,!0)},goRoot(){null!=this.folder&&(this.folder=null,this.hierarchyFolders=[],this.$emit("move-root"),this.fetch())},fetch(){this.folders=[],this.files=[],this.moreFolders=!1,this.moreFiles=!1,this.fetching=!0;let e=null,t=null;this.$root.api("drive/folders",{folderId:this.folder?this.folder.id:null,limit:31}).then(t=>{31==t.length&&(this.moreFolders=!0,t.pop()),e=t,a()}),this.$root.api("drive/files",{folderId:this.folder?this.folder.id:null,type:this.type,limit:31}).then(e=>{31==e.length&&(this.moreFiles=!0,e.pop()),t=e,a()});let i=!1;const a=()=>{if(i){for(const t of e)this.appendFolder(t);for(const e of t)this.appendFile(e);this.fetching=!1}else i=!0}},fetchMoreFiles(){this.fetching=!0;this.$root.api("drive/files",{folderId:this.folder?this.folder.id:null,type:this.type,untilId:this.files[this.files.length-1].id,limit:31}).then(e=>{31==e.length?(this.moreFiles=!0,e.pop()):this.moreFiles=!1;for(const t of e)this.appendFile(t);this.fetching=!1})}}}),y=(i(1012),Object(n.a)(x,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"mk-drive"},[i("nav",[i("div",{staticClass:"path",on:{contextmenu:function(e){e.preventDefault(),e.stopPropagation()}}},[i("x-nav-folder",{class:{current:null==e.folder}}),e._l(e.hierarchyFolders,(function(e){return[i("span",{staticClass:"separator"},[i("fa",{attrs:{icon:"angle-right"}})],1),i("x-nav-folder",{key:e.id,attrs:{folder:e}})]})),null!=e.folder?i("span",{staticClass:"separator"},[i("fa",{attrs:{icon:"angle-right"}})],1):e._e(),null!=e.folder?i("span",{staticClass:"folder current"},[e._v(e._s(e.folder.name))]):e._e()],2)]),i("div",{ref:"main",staticClass:"main",class:{uploading:e.uploadings.length>0,fetching:e.fetching},on:{mousedown:e.onMousedown,dragover:function(t){return t.preventDefault(),t.stopPropagation(),e.onDragover(t)},dragenter:e.onDragenter,dragleave:e.onDragleave,drop:function(t){return t.preventDefault(),t.stopPropagation(),e.onDrop(t)},contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.onContextmenu(t)}}},[i("div",{ref:"selection",staticClass:"selection"}),i("div",{ref:"contents",staticClass:"contents"},[e.folders.length>0||e.moreFolders?i("div",{ref:"foldersContainer",staticClass:"folders"},[e._l(e.folders,(function(e){return i("x-folder",{key:e.id,staticClass:"folder",attrs:{folder:e}})})),e._l(16,(function(e){return i("div",{staticClass:"padding"})})),e.moreFolders?i("ui-button",[e._v(e._s(e.$t("@.load-more")))]):e._e()],2):e._e(),e.files.length>0||e.moreFiles?i("div",{ref:"filesContainer",staticClass:"files"},[e._l(e.files,(function(e){return i("x-file",{key:e.id,staticClass:"file",attrs:{file:e}})})),e._l(16,(function(e){return i("div",{staticClass:"padding"})})),e.moreFiles?i("ui-button",{on:{click:e.fetchMoreFiles}},[e._v(e._s(e.$t("@.load-more")))]):e._e()],2):e._e(),0!=e.files.length||e.moreFiles||0!=e.folders.length||e.moreFolders||e.fetching?e._e():i("div",{staticClass:"empty"},[e.draghover?i("p",[e._v(e._s(e.$t("empty-draghover")))]):e._e(),e.draghover||null!=e.folder?e._e():i("p",[i("strong",[e._v(e._s(e.$t("empty-drive")))]),i("br"),e._v(e._s(e.$t("empty-drive-description")))]),e.draghover||null==e.folder?e._e():i("p",[e._v(e._s(e.$t("empty-folder")))])])]),e.fetching?i("div",{staticClass:"fetching"},[e._m(0)]):e._e()]),e.draghover?i("div",{staticClass:"dropzone"}):e._e(),i("mk-uploader",{ref:"uploader",on:{change:e.onChangeUploaderUploads,uploaded:e.onUploaderUploaded}}),i("input",{ref:"fileInput",attrs:{type:"file",accept:"*/*",multiple:"multiple",tabindex:"-1"},on:{change:e.onChangeFileInput}})],1)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"spinner"},[t("div",{staticClass:"dot1"}),t("div",{staticClass:"dot2"})])}],!1,null,"fae14316",null));t.default=y.exports},325:function(e,t,i){var a=i(467);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i(5).default)("194b0d7c",a,!0,{})},455:function(e,t,i){"use strict";var a=i(0),o=i(11),r=i(2),s=a.default.extend({props:{file:{type:Object,required:!0},fit:{type:String,required:!1,default:"cover"},detail:{type:Boolean,required:!1,default:!1}},data:()=>({isContextmenuShowing:!1,isDragging:!1,faFile:r.kb,faFileAlt:r.lb,faFileImage:r.ob,faMusic:r.hc,faFileVideo:r.rb,faFileCsv:r.nb,faFilePdf:r.qb,faFileArchive:r.mb,faFilm:r.sb}),computed:{is(){return this.file.type.startsWith("image/")?"image":this.file.type.startsWith("video/")?"video":"audio/midi"===this.file.type?"midi":this.file.type.startsWith("audio/")?"audio":this.file.type.endsWith("/csv")?"csv":this.file.type.endsWith("/pdf")?"pdf":this.file.type.startsWith("text/")?"textfile":["application/zip","application/x-cpio","application/x-bzip","application/x-bzip2","application/java-archive","application/x-rar-compressed","application/x-tar","application/gzip","application/x-7z-compressed"].some(e=>e===this.file.type)?"archive":"unknown"},isThumbnailAvailable(){return!!this.file.thumbnailUrl&&("image"===this.is||"video"===this.is)},background(){return this.file.properties.avgColor||"transparent"}},mounted(){const e=this.$refs.volumectrl;e&&(e.volume=this.$store.state.device.mediaVolume)},methods:{onThumbnailLoaded(){this.file.properties.avgColor&&Object(o.a)({targets:this.$refs.thumbnail,backgroundColor:"transparent",duration:100,easing:"linear"})},volumechange(){const e=this.$refs.volumectrl;this.$store.commit("device/set",{key:"mediaVolume",value:e.volume})}}}),n=(i(466),i(1)),d=Object(n.a)(s,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"thumbnail",staticClass:"zdjebgpv",class:{detail:e.detail},style:"background-color: "+e.background},[e.detail&&"image"===e.is?i("img",{attrs:{src:e.file.url,alt:e.file.name,title:e.file.name},on:{load:e.onThumbnailLoaded}}):e.detail&&"video"===e.is?i("video",{ref:"volumectrl",attrs:{src:e.file.url,preload:"metadata",controls:""}}):e.isThumbnailAvailable?i("img",{style:"object-fit: "+e.fit,attrs:{src:e.file.thumbnailUrl,alt:""},on:{load:e.onThumbnailLoaded}}):"image"===e.is?i("fa",{staticClass:"icon",attrs:{icon:e.faFileImage}}):"video"===e.is?i("fa",{staticClass:"icon",attrs:{icon:e.faFileVideo}}):e.detail&&"audio"===e.is?i("audio",{ref:"volumectrl",attrs:{src:e.file.url,preload:"metadata",controls:""}}):"audio"===e.is||"midi"===e.is?i("fa",{staticClass:"icon",attrs:{icon:e.faMusic}}):"csv"===e.is?i("fa",{staticClass:"icon",attrs:{icon:e.faFileCsv}}):"pdf"===e.is?i("fa",{staticClass:"icon",attrs:{icon:e.faFilePdf}}):"textfile"===e.is?i("fa",{staticClass:"icon",attrs:{icon:e.faFileAlt}}):"archive"===e.is?i("fa",{staticClass:"icon",attrs:{icon:e.faFileArchive}}):i("fa",{staticClass:"icon",attrs:{icon:e.faFile}}),!e.detail&&e.isThumbnailAvailable&&"video"===e.is?i("fa",{staticClass:"icon-sub",attrs:{icon:e.faFilm}}):e._e()],1)}),[],!1,null,"cd0797c6",null);t.a=d.exports},466:function(e,t,i){"use strict";var a=i(325);i.n(a).a},467:function(e,t,i){(t=i(4)(!1)).push([e.i,".zdjebgpv[data-v-cd0797c6]{display:flex}.zdjebgpv>.icon[data-v-cd0797c6],.zdjebgpv>img[data-v-cd0797c6]{pointer-events:none}.zdjebgpv>.icon-sub[data-v-cd0797c6]{position:absolute;width:30%;height:auto;margin:0;right:4%;bottom:4%}.zdjebgpv>*[data-v-cd0797c6]{margin:auto}.zdjebgpv:not(.detail)>img[data-v-cd0797c6]{height:100%;width:100%;object-fit:cover}.zdjebgpv:not(.detail)>.icon[data-v-cd0797c6]{height:65%;width:65%}.zdjebgpv:not(.detail)>audio[data-v-cd0797c6],.zdjebgpv:not(.detail)>video[data-v-cd0797c6]{width:100%}.zdjebgpv.detail>.icon[data-v-cd0797c6]{height:100px;width:100px;margin:16px}.zdjebgpv.detail[data-v-cd0797c6]>:not(.icon){max-height:300px;max-width:100%;height:100%;object-fit:contain}",""]),e.exports=t},764:function(e,t,i){var a=i(1007);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i(5).default)("0c87042e",a,!0,{})},765:function(e,t,i){var a=i(1009);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i(5).default)("ec900552",a,!0,{})},766:function(e,t,i){var a=i(1011);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i(5).default)("c902f6da",a,!0,{})},767:function(e,t,i){var a=i(1013);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i(5).default)("4a80a2c5",a,!0,{})}}]);
//# sourceMappingURL=5.11.37.1.js.map